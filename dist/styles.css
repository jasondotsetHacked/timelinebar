/* Extracted from timelinebar.html */
:root {
  --bg: #000;
  --panel: #000;
  --panel-2: #001000;
  --text: #00ff66;
  --muted: #00b865;
  --brand: #00ff66;
  --brand-2: #00994d;
  --accent: #00ff66;
  --danger: #ff3333;
  --shadow: 0 10px 30px rgba(0,0,0,.35);
  --input-bg: #000;
}

:root[data-theme='light'] {
  --bg: #f6f8fa;
  --panel: #ffffff;
  --panel-2: #f3f6fb;
  --text: #0d1321;
  --muted: #5c6b73;
  --brand: #16a34a;
  --brand-2: #0e7a3d;
  --accent: #16a34a;
  --danger: #dc2626;
  --shadow: 0 10px 30px rgba(0,0,0,.12);
  --input-bg: #ffffff;
}

/* Light theme tweaks for buttons */
:root[data-theme='light'] .btn.ghost {
  background: rgba(16,24,40,0.06);
  border: 1px solid rgba(16,24,40,0.12);
}
:root[data-theme='light'] .btn.ghost:hover {
  background: rgba(16,24,40,0.1);
}

* { box-sizing: border-box; }
html, body { height: 100%; }
body {
  margin: 0;
  font-family: 'Courier New', monospace;
  color: var(--text);
  background: var(--bg);
  display: grid;
  place-items: start center;
  padding: 32px 16px 80px;
  text-shadow: none;
  position: relative;
}

body::after {
  content: '';
  position: fixed;
  inset: 0;
  pointer-events: none;
  background: transparent;
  backdrop-filter: none;
}

.app { width: min(1100px, 96vw); display: grid; gap: 24px; }

.header { display: flex; align-items: end; justify-content: space-between; gap: 12px; }
.title { font-size: clamp(22px, 3vw, 28px); font-weight: 700; letter-spacing: .2px; }
.subtle { color: var(--muted); font-size: 13px; }
/* Day label as a link to open calendar */
#dayLabel.clickable { cursor: pointer; display: inline-block; border-bottom: 1px dotted rgba(255,255,255,.25); }
#dayLabel.clickable:hover { border-bottom-color: rgba(255,255,255,.5); }

.card { background: linear-gradient(180deg, var(--panel), var(--panel-2)); border: 1px solid rgba(0,255,102,0.2); border-radius: 16px; box-shadow: var(--shadow); overflow: visible; }

/* Timeline */
.timeline { padding: 30px 20px; }

.track {
  position: relative;
  height: 92px;
  background: linear-gradient(90deg, rgba(255,255,255,.06), rgba(255,255,255,.04));
  border: 1px solid rgba(255,255,255,.08);
  border-radius: 14px;
  /* allow tick labels positioned above the track to be visible */
  overflow: visible;
  cursor: crosshair;
  user-select: none;
  isolation: isolate;
}

.tick-labels { position: absolute; inset: 0; overflow: visible; pointer-events: none; z-index: 0; }
/* unified tick: full-height line + label bound together */
.tick { position: absolute; top: 0; bottom: 0; }
.tick-line { position: absolute; left: 0; top: 0; bottom: 0; width: 1px; background: rgba(255,255,255,.12); transform: translateX(-50%); }
.tick-label { position: absolute; top: -22px; transform: translateX(-50%); font-size: 12px; color: var(--muted); white-space: nowrap; text-shadow: 0 1px 0 rgba(0,0,0,.4); }
.tick[data-edge="start"] .tick-label { transform: translateX(0%); }
.tick[data-edge="end"] .tick-label { transform: translateX(-100%); }

/* Current time indicator */
.now-indicator { position: absolute; top: 0; bottom: 0; width: 2px; background: #ffd046; box-shadow: 0 0 0 1px rgba(0,0,0,.25), 0 0 10px rgba(255,208,70,.4); transform: translateX(-50%); pointer-events: none; z-index: 2; }
/* Dimmed style when viewing a non-today date */
.now-indicator.not-today { background: rgba(255,255,255,.5); box-shadow: 0 0 0 1px rgba(0,0,0,.25); opacity: .55; }

.ghost { position: absolute; top: 0; bottom: 0; background: linear-gradient(180deg, rgba(0,255,102,.3), rgba(0,255,102,.18)); border-left: 2px dashed var(--brand-2); border-right: 2px dashed var(--brand-2); display: none; pointer-events: none; z-index: 1; }

.tip { position: absolute; top: -36px; transform: translateX(-50%); background: var(--panel); color: var(--text); border: 1px solid rgba(0,255,102,0.3); border-radius: 10px; padding: 4px 8px; font-size: 12px; white-space: nowrap; display: none; pointer-events: none; z-index: 2; box-shadow: var(--shadow); }
.tip-center { top: auto; bottom: -36px; }

.punch { position: absolute; top: 16px; bottom: 16px; border-radius: 10px; background: rgba(0,255,102,0.15); border: 1px solid rgba(0,255,102,0.6); box-shadow: inset 0 0 0 1px rgba(0,255,102,0.2), 0 6px 16px rgba(0,0,0,.35); display: flex; align-items: center; justify-content: center; overflow: hidden; cursor: default; padding: 0 12px; color: var(--text); }
.punch-label { font-weight: 600; font-size: 18px; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding: 0 8px; color: var(--text); text-shadow: none; margin: 0; flex: 1; }

/* small indicator for notes inside a punch */
.punch .note-dot { position: absolute; top: 4px; right: 4px; width: 10px; height: 10px; border-radius: 50%; background: #ffd046; box-shadow: 0 0 0 1px rgba(0,0,0,.35), 0 0 6px rgba(255,208,70,.6); border: 0; cursor: pointer; padding: 0; display: inline-block; z-index: 40; }
.punch .note-dot:hover { filter: brightness(1.1); }

/* handles are grid children (first and last column). They sit entirely inside the block and match the dark inner edge */
.handle { position: absolute; top: 0; bottom: 0; width: 12px; display: block; cursor: ew-resize; background: transparent; z-index: 30; pointer-events: auto; }
.handle.left { left: 0; }
.handle.right { right: 0; }

/* visible inner bar on the handle (anchored to the inner edge) */
.handle-bar { position: absolute; top: 0; bottom: 0; width: 6px; background: linear-gradient(270deg, rgba(0,0,0,0.22), rgba(0,0,0,0.08)); pointer-events: none; }
/* flipped orientation: round the edge facing the block center */
.handle.left .handle-bar { left: 0; border-top-left-radius: 8px; border-bottom-left-radius: 8px; }
.handle.right .handle-bar { right: 0; border-top-right-radius: 8px; border-bottom-right-radius: 8px; }

/* active glow for the edge being resized */
.punch.resizing-left .handle.left .handle-bar,
.punch.resizing-right .handle.right .handle-bar {
  box-shadow: 0 0 0 4px rgba(0,255,102,0.18), inset 0 0 0 2px rgba(0,255,102,0.12);
}

/* indicate which handle will be grabbed on hover/focus (pre-resize feedback) */
.handle.left:hover .handle-bar, .handle.left:focus .handle-bar, .handle.left:focus-visible .handle-bar {
  box-shadow: 0 0 0 4px rgba(0,255,102,0.12), inset 0 0 0 2px rgba(0,255,102,0.08);
}
.handle.right:hover .handle-bar, .handle.right:focus .handle-bar, .handle.right:focus-visible .handle-bar {
  box-shadow: 0 0 0 4px rgba(0,255,102,0.12), inset 0 0 0 2px rgba(0,255,102,0.08);
}

/* remove default focus outline but keep accessible focus-visible handling */
.handle:focus { outline: none; }

/* narrow block handling: move label outside so it stays legible */
.punch.narrow { /* keep label outside but make handles slightly larger visually */
  overflow: hidden;
}
.punch.narrow .punch-label { display: none; }
.punch.narrow .handle { transform: none; }
/* hide the in-block edit/delete buttons for narrow punches (we show popper controls instead) */
.punch.narrow .controls { display: none !important; }

/* label popper rendered below the timeline when blocks are very narrow */
.label-layer { position: absolute; left: 0; right: 0; top: 100%; pointer-events: none; }
.label-popper { position: absolute; pointer-events: auto; /* let popper size to content so full bucket labels display */ min-width: 110px; max-width: 420px; width: max-content; background: rgba(11,18,39,0.95); color: var(--text); border: 1px solid rgba(255,255,255,.08); padding: 6px 8px; border-radius: 8px; font-size: 12px; display: grid; grid-template-columns: 1fr auto; gap: 6px; align-items: center; box-shadow: var(--shadow); z-index: 90; white-space: nowrap; }
.label-popper .label-text { overflow: visible; text-overflow: clip; white-space: nowrap; font-weight: 600; }
.label-popper .controls { position: static; display: flex; gap: 6px; }
.label-popper .control-btn { width: 26px; height: 26px; }
.label-connector { position: absolute; width: 2px; background: var(--brand-2); z-index: 80; pointer-events: none; }

/* controls shown on hover for edit/delete */
.punch .controls { position: absolute; right: 6px; top: 6px; display: flex; gap: 6px; opacity: 0; transition: opacity .12s ease; z-index: 4; }
.punch:hover .controls { opacity: 1; }
.punch .control-btn { appearance: none; border: 0; background: rgba(0,0,0,.18); color: var(--text); width: 26px; height: 26px; border-radius: 6px; display: grid; place-items: center; font-size: 12px; cursor: pointer; }
.punch .control-btn.delete { background: rgba(255,107,107,0.9); color: #091019; }
.punch.invalid { outline: 2px solid var(--danger); }

/* Remove in-block and popper controls entirely */
.punch .controls, .label-popper .controls { display: none !important; }

/* Floating popover for full note content */
.note-popover { position: fixed; max-width: 520px; min-width: 260px; background: var(--panel); color: var(--text); border: 1px solid rgba(0,255,102,0.3); border-radius: 12px; box-shadow: var(--shadow); padding: 10px 12px; z-index: 300; }
.note-popover .note-content { max-height: 260px; overflow: auto; }
.note-popover .note-close { position: absolute; top: 6px; right: 6px; appearance: none; border: 0; background: transparent; color: var(--muted); cursor: pointer; font-size: 16px; padding: 4px; border-radius: 8px; }
.note-popover .note-close:hover { background: rgba(255,255,255,.06); color: var(--text); }
.note-popover a { color: var(--brand-2); }
.note-popover pre { background: rgba(255,255,255,.06); border-radius: 8px; padding: 8px; overflow: auto; }
.note-popover code { background: rgba(255,255,255,.08); border-radius: 4px; padding: 0 3px; }
.note-popover h1, .note-popover h2, .note-popover h3 { margin: .4em 0 .2em; }
.note-popover p { margin: .4em 0; }

/* Hover highlight syncing between track blocks and table rows */
.punch.is-hovered { outline: 2px solid rgba(255,255,255,.35); box-shadow: inset 0 0 0 1px rgba(255,255,255,.15), 0 8px 20px rgba(0,0,0,.5); }
tbody tr.is-hovered { background: rgba(255,255,255,.06); }

/* Status coloring for punches */
.punch.status-green { background: rgba(0,255,0,0.15); border-color: #00ff00; }
.punch.status-green .punch-label { color: #00ff00; }
.punch.status-green-solid { background: #00ff00; border-color: #00ff00; }
.punch.status-green-solid .punch-label { color: #000; }

.punch.status-yellow { background: rgba(255,255,0,0.15); border-color: #ffff00; }
.punch.status-yellow .punch-label { color: #ffff00; }
.punch.status-yellow-solid { background: #ffff00; border-color: #ffff00; }
.punch.status-yellow-solid .punch-label { color: #000; }

.punch.status-red { background: rgba(255,0,0,0.15); border-color: #ff3333; }
.punch.status-red .punch-label { color: #ff3333; }
.punch.status-red-solid { background: #ff3333; border-color: #ff3333; }
.punch.status-red-solid .punch-label { color: #000; }

.punch.status-blue { background: rgba(0,128,255,0.15); border-color: #0080ff; }
.punch.status-blue .punch-label { color: var(--text); }
.punch.status-blue-solid { background: #0080ff; border-color: #0080ff; }
.punch.status-blue-solid .punch-label { color: #fff; }

.punch.status-purple { background: rgba(170,0,255,0.15); border-color: #aa00ff; }
.punch.status-purple .punch-label { color: var(--text); }
.punch.status-purple-solid { background: #aa00ff; border-color: #aa00ff; }
.punch.status-purple-solid .punch-label { color: #fff; }

.punch.status-default { /* keep the default styling */ }

.help-row { display: flex; justify-content: space-between; align-items: center; padding: 10px 16px 16px; border-top: 1px dashed rgba(255,255,255,.08); color: var(--muted); font-size: 13px; }

/* Modal */
.modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,.45); display: none; align-items: center; justify-content: center; z-index: 50; padding: 20px; }
.modal { width: 520px; max-width: 96vw; }
.modal .body { padding: 18px; display: grid; gap: 12px; }
.row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
label { font-size: 12px; color: var(--muted); display: block; margin-bottom: 6px; }
input[type="text"], textarea, input[readonly], select { width: 100%; border: 1px solid rgba(0,255,102,0.3); background: var(--input-bg); color: var(--text); border-radius: 10px; padding: 10px 12px; font-size: 14px; }
textarea { resize: vertical; min-height: 72px; }
.note-foot { margin-top: 6px; display: flex; gap: 6px; align-items: center; }
.note-foot a { color: var(--brand-2); text-decoration: none; }
.note-foot a:hover { text-decoration: underline; }
.note-preview { margin-top: 8px; border: 1px dashed rgba(255,255,255,.12); border-radius: 10px; padding: 10px 12px; background: rgba(255,255,255,.04); font-size: 14px; max-height: 200px; overflow: auto; }
.note-preview pre { background: rgba(0,0,0,.35); padding: 8px; border-radius: 8px; overflow: auto; }
.note-preview code { background: rgba(0,0,0,.35); padding: 0 3px; border-radius: 4px; }
.modal-header { display: flex; justify-content: space-between; align-items: center; padding: 14px 18px; }
.modal-title { font-weight: 700; letter-spacing:.2px; }
.icon-btn { appearance: none; border: 0; background: transparent; color: var(--muted); font-size: 20px; line-height: 1; cursor: pointer; padding: 6px; border-radius: 8px; }
.icon-btn:hover { background: rgba(255,255,255,.06); color: var(--text); }
.modal-footer { display: flex; justify-content: end; gap: 8px; padding: 0 18px 18px; }
.btn { appearance: none; border: 0; border-radius: 10px; padding: 10px 14px; font-weight: 700; cursor: pointer; }
.btn.primary { background: linear-gradient(180deg, var(--accent), #18b67c); color: #042416; }
.btn.ghost { background: rgba(255,255,255,.06); color: var(--text); }
.btn.danger { background: #ff6b6b; color: #1e0f0f; }

/* Table */
/* Allow status dropdowns to overflow outside the card without clipping */
.table-card { overflow: visible; position: relative; z-index: 5; }
table { width: 100%; border-collapse: collapse; }
thead { background: rgba(255,255,255,.04); }
th, td { text-align: left; padding: 12px 14px; font-size: 14px; }
tbody tr + tr td { border-top: 1px dashed rgba(255,255,255,.08); }
td.note { color: var(--muted); }
.empty { padding: 18px; text-align: center; color: var(--muted); }

/* Status selector cell */
td.status-cell, th.status-cell { padding-left: 10px; padding-right: 10px; width: 40px; }
.status-wrap { position: relative; }
.status-btn { appearance: none; width: 18px; height: 18px; border-radius: 4px; border: 1px solid rgba(0,255,102,0.3); cursor: pointer; background: rgba(0,255,102,0.1); display: inline-block; }
.status-btn.status-green { background: rgba(0,255,0,0.3); border-color: #00ff00; }
.status-btn.status-green-solid { background: #00ff00; border-color: #00ff00; }
.status-btn.status-yellow { background: rgba(255,255,0,0.3); border-color: #ffff00; }
.status-btn.status-yellow-solid { background: #ffff00; border-color: #ffff00; }
.status-btn.status-red { background: rgba(255,0,0,0.3); border-color: #ff3333; }
.status-btn.status-red-solid { background: #ff3333; border-color: #ff3333; }
.status-btn.status-blue { background: rgba(0,128,255,0.3); border-color: #0080ff; }
.status-btn.status-blue-solid { background: #0080ff; border-color: #0080ff; }
.status-btn.status-purple { background: rgba(170,0,255,0.3); border-color: #aa00ff; }
.status-btn.status-purple-solid { background: #aa00ff; border-color: #aa00ff; }
.status-btn.status-default { background: rgba(0,255,102,0.1); }

.status-menu { position: absolute; top: 24px; left: 0; background: #000; border: 1px solid rgba(0,255,102,0.3); border-radius: 8px; padding: 6px; display: none; grid-template-columns: repeat(4, 20px); gap: 6px; box-shadow: var(--shadow); z-index: 200; }
.status-option { width: 18px; height: 18px; border-radius: 4px; border: 1px solid rgba(0,255,102,0.3); cursor: pointer; }
.status-option[data-value="green"] { background: rgba(0,255,0,0.3); border-color: #00ff00; }
.status-option[data-value="green-solid"] { background: #00ff00; border-color: #00ff00; }
.status-option[data-value="yellow"] { background: rgba(255,255,0,0.3); border-color: #ffff00; }
.status-option[data-value="yellow-solid"] { background: #ffff00; border-color: #ffff00; }
.status-option[data-value="red"] { background: rgba(255,0,0,0.3); border-color: #ff3333; }
.status-option[data-value="red-solid"] { background: #ff3333; border-color: #ff3333; }
.status-option[data-value="blue"] { background: rgba(0,128,255,0.3); border-color: #0080ff; }
.status-option[data-value="blue-solid"] { background: #0080ff; border-color: #0080ff; }
.status-option[data-value="purple"] { background: rgba(170,0,255,0.3); border-color: #aa00ff; }
.status-option[data-value="purple-solid"] { background: #aa00ff; border-color: #aa00ff; }
.status-option[data-value="default"] { background: rgba(0,255,102,0.1); }

/* Open state */
.status-wrap.open .status-menu { display: grid; }
/* Open upwards modifier when near bottom */
.status-wrap.up .status-menu { top: auto; bottom: 24px; }

/* Table actions */
.table-actions { white-space: nowrap; }
.row-action { appearance: none; border: 0; border-radius: 8px; padding: 6px 10px; font-size: 12px; font-weight: 700; cursor: pointer; margin-right: 6px; }
.row-action.edit { background: rgba(255,255,255,.08); color: var(--text); }
.row-action.delete { background: var(--danger); color: #091019; }
tbody tr { cursor: pointer; }
tbody tr .row-action { cursor: pointer; }

/* Toast */
.toast { position: fixed; bottom: 18px; left: 50%; transform: translateX(-50%); background: #111b37; color: var(--text); border: 1px solid rgba(255,255,255,.12); border-radius: 12px; padding: 10px 14px; font-size: 14px; display: none; z-index: 60; box-shadow: var(--shadow); }

/* Calendar */
.calendar { overflow: visible; }
.calendar-weekdays .cal-weekday { text-align: center; font-size: 12px; color: var(--muted); padding: 6px 4px; }
.calendar-grid { user-select: none; transition: opacity .15s ease; }
.cal-day { position: relative; min-height: 72px; border: 1px solid rgba(255,255,255,.08); border-radius: 10px; padding: 8px; background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.02)); cursor: pointer; }
.cal-day:hover { border-color: rgba(255,255,255,.16); box-shadow: 0 2px 8px rgba(0,0,0,.25) inset; }
.cal-day.other-month { opacity: .5; }
.cal-day.selected { outline: 2px solid var(--brand-2); outline-offset: 2px; }
.cal-day.today { outline: 2px solid #ffd046; outline-offset: 2px; }
.cal-day.has-items { border-color: rgba(0,255,102,0.35); }
.cal-num { font-weight: 700; font-size: 12px; color: var(--muted); }
.cal-meta { position: absolute; right: 8px; bottom: 6px; font-size: 11px; color: var(--muted); }

/* Month view: unique bucket list per day */
.cal-buckets {
  position: absolute;
  left: 8px;
  right: 8px;
  top: 24px; /* below the day number */
  bottom: 6px;
  overflow: auto;
  -ms-overflow-style: none; /* IE 10+ */
  scrollbar-width: none;    /* Firefox */
  user-select: none;
}
.cal-buckets::-webkit-scrollbar { width: 0; height: 0; }
.cal-bucket {
  font-size: 11px;
  line-height: 1.2;
  color: var(--text);
  opacity: .95;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Clickable month/year pieces in label */
#calMonthLabel .cal-link { cursor: pointer; border-bottom: 1px dotted rgba(255,255,255,.25); }
#calMonthLabel .cal-link:hover { border-bottom-color: rgba(255,255,255,.5); }
#calMonthLabel .cal-range { color: var(--muted); }
/* Inline prev/next nav inside label for months/years views */
#calMonthLabel .cal-nav { display: inline-block; cursor: pointer; padding: 2px 8px; margin: 0 6px; border-radius: 8px; background: rgba(255,255,255,.06); color: var(--text); user-select: none; }
#calMonthLabel .cal-nav:hover { background: rgba(255,255,255,.12); }

/* Floating calendar FAB */
.fab { position: fixed; right: 18px; bottom: 18px; z-index: 80; padding: 12px 16px; border-radius: 999px; font-weight: 800; background: linear-gradient(180deg, var(--brand), var(--brand-2)); color: #08121f; box-shadow: var(--shadow); }
.fab:hover { filter: brightness(1.08); }
