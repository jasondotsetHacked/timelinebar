<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Time Tracker — Single File</title>
  <link rel="stylesheet" href="styles.css">
  <!-- Markdown + sanitizer for note popovers -->
  <script src="https://cdn.jsdelivr.net/npm/marked@12.0.2/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>
</head>
<body>
  <div class="app">
    <div class="header">
      <div>
        <div class="title">Time Tracker</div>
        <div id="viewHelp" class="subtle"></div>
      </div>
      <div>
        <button id="btnSettings" class="icon-btn" title="Settings">&#9881;</button>
      </div>
    </div>

    <div class="top-controls" id="topControls" style="display:flex; justify-content: space-between; align-items:center; gap:8px;">
      <div id="dayLabel" class="subtle" title="Open calendar" tabindex="0" role="button"></div>
      <div style="display:flex; gap:8px; align-items:center;">
        <button id="btnCalendar" class="btn ghost" title="Open calendar">Calendar</button>
        <button id="btnCopyChartTop" class="btn ghost" title="Copy timeline chart to clipboard">⧉ Copy</button>
      </div>
    </div>

    <section class="card calendar" id="calendarCard" style="display:none; padding:16px;">
      <div class="calendar-header" style="display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom:10px; padding:0 4px;">
        <button class="btn ghost" id="calPrev" title="Previous">&#171;</button>
        <div id="calMonthLabel" style="font-weight:700; letter-spacing:.2px;"></div>
        <button class="btn ghost" id="calNext" title="Next">&#187;</button>
      </div>
      <div class="calendar-weekdays" id="calWeekdays" style="display:grid; grid-template-columns: repeat(7, 1fr); gap:6px; margin-bottom:6px;">
        <div class="cal-weekday">Sun</div>
        <div class="cal-weekday">Mon</div>
        <div class="cal-weekday">Tue</div>
        <div class="cal-weekday">Wed</div>
        <div class="cal-weekday">Thu</div>
        <div class="cal-weekday">Fri</div>
        <div class="cal-weekday">Sat</div>
      </div>
      <div class="calendar-grid" id="calendarGrid" style="display:grid; grid-template-columns: repeat(7, 1fr); gap:6px;"></div>
    </section>

    <section class="card timeline">
      <div class="track" id="track" aria-label="Timeline track" role="application">
        <div class="ghost" id="ghost"></div>
        <div class="tip" id="tipStart"></div>
        <div class="tip" id="tipEnd"></div>
        <div class="tip tip-center" id="tipCenter"></div>
        <div class="tick-labels" id="ticks"></div>
      </div>
      <!-- Mobile: timeline zoom/pan controls -->
      <div class="mobile-controls" id="mobileControls">
        <button id="mobileZoomOut" class="btn ghost mobile-zoom" title="Zoom out" aria-label="Zoom out">&#8722;</button>
        <div id="mobileScrollbar" class="mobile-scrollbar" aria-label="Timeline viewport">
          <div id="mobileWindow" class="mobile-window" role="slider" aria-valuemin="0" aria-valuemax="1440" aria-valuenow="0" aria-label="Visible time window"></div>
        </div>
        <button id="mobileZoomIn" class="btn ghost mobile-zoom" title="Zoom in" aria-label="Zoom in">&#43;</button>
        <input id="mobileZoomRange" class="mobile-zoom-range" type="range" min="45" max="1440" step="15" value="720" aria-label="Zoom" />
      </div>
      <div class="help-row">
        <div>
          New: drag anywhere. Edit: drag a block's side handle.
        </div>
        <div style="display:flex; gap:8px; align-items:center;">
          <button id="viewDefault" class="btn ghost" title="Reset to 6am–6pm" style="padding:6px 10px; font-size:12px;">6–6</button>
          <button id="view24" class="btn ghost" title="Show 24 hours" style="padding:6px 10px; font-size:12px;">24h</button>
          <button id="btnCalendar2" class="btn ghost" title="Open calendar" style="padding:6px 10px; font-size:12px;">Calendar</button>
          <button id="btnCopyChart" class="btn ghost" title="Copy timeline chart to clipboard" style="padding:6px 10px; font-size:12px;">⧉ Copy</button>
          <div id="total" class="subtle"></div>
        </div>
      </div>
    </section>

    <section class="card table-card">
      <table id="entriesTable">
        <thead>
          <tr>
            <th style="width:40px"></th>
            <th style="width:140px">Start</th>
            <th style="width:140px">Stop</th>
            <th style="width:150px">Duration</th>
            <th style="width:180px">Bucket</th>
            <th>Note</th>
            <th style="width:120px; white-space:nowrap">Actions <button id="btnCopyChartTable" class="icon-btn" title="Copy timeline chart to clipboard" aria-label="Copy timeline">⧉</button></th>
          </tr>
        </thead>
        <tbody id="rows"></tbody>
      </table>
      <div class="empty" id="empty">No entries yet. Create your first by dragging on the timeline.</div>
    </section>

    <section class="card table-card" id="bucketDayCard">
      <div style="display:flex; align-items:center; justify-content:space-between; padding:12px 14px 0 14px;">
        <div class="subtle" style="font-weight:700; letter-spacing:.2px;">Bucket Report (Day)</div>
      </div>
      <table>
        <thead>
          <tr>
            <th>Bucket</th>
            <th style="width:160px">Duration</th>
          </tr>
        </thead>
        <tbody id="bucketDayBody"></tbody>
      </table>
      <div class="empty" id="bucketDayEmpty">No time tracked for this day.</div>
    </section>

    <section class="card table-card" id="bucketMonthCard" style="display:none;">
      <div style="display:flex; align-items:center; justify-content:space-between; padding:12px 14px 0 14px;">
        <div class="subtle" style="font-weight:700; letter-spacing:.2px;">Bucket Report (Month) <span id="bucketMonthTitle"></span></div>
      </div>
      <table>
        <thead>
          <tr>
            <th>Bucket</th>
            <th style="width:160px">Duration</th>
          </tr>
        </thead>
        <tbody id="bucketMonthBody"></tbody>
      </table>
      <div class="empty" id="bucketMonthEmpty">No time tracked for this month.</div>
    </section>
  </div>

  <div class="modal-backdrop" id="modal">
    <div class="card modal">
      <div class="modal-header">
        <div class="modal-title">New Time Block</div>
        <button class="icon-btn" id="modalClose" aria-label="Close">&#x2715;</button>
      </div>
      <form id="modalForm">
        <div class="body">
          <div class="row">
            <div>
              <label>Start</label>
              <input type="text" id="startField" readonly />
            </div>
            <div>
              <label>End</label>
              <input type="text" id="endField" readonly />
            </div>
          </div>
          <div class="row">
            <div>
              <label>Status</label>
              <div class="status-wrap" id="modalStatusWrap">
                <button type="button" class="status-btn status-default" id="modalStatusBtn" aria-label="Status"></button>
                <div class="status-menu" id="modalStatusMenu">
                  <div class="status-option" data-value="default" title="Default"></div>
                  <div class="status-option" data-value="green" title="Green (transparent)"></div>
                  <div class="status-option" data-value="green-solid" title="Green"></div>
                  <div class="status-option" data-value="yellow" title="Yellow (transparent)"></div>
                  <div class="status-option" data-value="yellow-solid" title="Yellow"></div>
                  <div class="status-option" data-value="red" title="Red (transparent)"></div>
                  <div class="status-option" data-value="red-solid" title="Red"></div>
                  <div class="status-option" data-value="blue" title="Blue (transparent)"></div>
                  <div class="status-option" data-value="blue-solid" title="Blue"></div>
                  <div class="status-option" data-value="purple" title="Purple (transparent)"></div>
                  <div class="status-option" data-value="purple-solid" title="Purple"></div>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div>
              <label>Bucket</label>
              <input type="text" id="bucketField" placeholder="e.g. A-01" required />
            </div>
            <div>
              <label>Note</label>
              <textarea id="noteField" placeholder="Write a note… Markdown supported"></textarea>
              <div class="note-foot subtle">
                <span>Markdown supported</span>
                <span aria-hidden="true"> · </span>
                <a id="notePreviewToggle" href="#" role="button">Preview</a>
              </div>
              <div id="notePreview" class="note-preview" style="display:none;"></div>
            </div>
          </div>
          <div class="row" id="repeatRow" style="grid-template-columns: 1fr;">
            <div>
              <label>Repeat</label>
              <div style="display:flex; align-items:center; gap:10px; flex-wrap:wrap;">
                <label style="display:flex; align-items:center; gap:6px;">
                  <input type="checkbox" id="repeatEnabled" /> Enable recurrence
                </label>
                <div id="repeatFields" style="display:none; width:100%;">
                  <div style="display:grid; grid-template-columns: 1fr; gap:10px; margin-top:6px;">
                    <div>
                      <label>Frequency</label>
                      <select id="repeatFreq">
                        <option value="daily">Every day</option>
                        <option value="weekly" selected>Every week</option>
                        <option value="monthly">Every month</option>
                        <option value="yearly">Every year</option>
                      </select>
                    </div>
                  </div>
                  <div id="repeatDowWrap" style="display:none; margin-top:8px;">
                    <label>Days of week</label>
                    <div class="dow-picker" id="repeatDow">
                      <label class="chip"><input type="checkbox" value="1" />Mon</label>
                      <label class="chip"><input type="checkbox" value="2" />Tue</label>
                      <label class="chip"><input type="checkbox" value="3" />Wed</label>
                      <label class="chip"><input type="checkbox" value="4" />Thu</label>
                      <label class="chip"><input type="checkbox" value="5" />Fri</label>
                      <label class="chip"><input type="checkbox" value="6" />Sat</label>
                      <label class="chip"><input type="checkbox" value="0" />Sun</label>
                    </div>
                    <div class="dow-presets">
                      <button type="button" class="btn ghost" id="btnDowWeekdays" style="padding:6px 10px; font-size:12px;">Mon–Fri</button>
                      <button type="button" class="btn ghost" id="btnDowAll" style="padding:6px 10px; font-size:12px;">All Days</button>
                    </div>
                  </div>
                  <div id="repeatUntilWrap" style="margin-top:6px;">
                    <label>End on date</label>
                    <input type="date" id="repeatUntil" />
                  </div>
                </div>
              </div>
            </div>
            <div id="applyScopeWrap" style="display:none; margin-top:6px;">
              <label>Apply changes to</label>
              <div style="display:flex; gap:14px;">
                <label><input type="radio" name="applyScope" id="applyScopeOne" value="one" /> Only this</label>
                <label><input type="radio" name="applyScope" id="applyScopeSeries" value="series" checked /> Entire series</label>
              </div>
            </div>
            <div id="extendWrap" style="display:none; margin-top:10px;">
              <label>Extend series</label>
              <div style="display:grid; grid-template-columns: 1fr auto; gap:10px; align-items:end;">
                <div>
                  <label>Extend until</label>
                  <input type="date" id="extendUntil" />
                </div>
                <button type="button" class="btn" id="btnExtendSeries">Extend</button>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn danger" id="modalDelete">Delete</button>
          <button type="button" class="btn ghost" id="modalCancel">Cancel</button>
          <button type="submit" class="btn primary">Save</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Settings modal -->
  <div class="modal-backdrop" id="settingsModal">
    <div class="card modal">
      <div class="modal-header">
        <div class="modal-title">Settings</div>
        <button class="icon-btn" id="settingsClose" aria-label="Close">&#x2715;</button>
      </div>
      <div class="body" style="padding-top: 4px;">
        <div class="row" style="grid-template-columns: 1fr;">
          <div>
            <label>Theme</label>
            <select id="themeSelect">
              <option value="neon">Neon (default)</option>
              <option value="light">Light</option>
            </select>
          </div>
        </div>
        <div class="row" style="grid-template-columns: 1fr 1fr; align-items:end;">
          <div>
            <label id="lblBackup" style="cursor:pointer;">Backup</label>
            <button id="btnExport" class="btn primary" style="width:100%;">Export Data</button>
          </div>
          <div>
            <label id="lblRestore" style="cursor:pointer;">Restore</label>
            <button id="btnImport" class="btn primary" style="width:100%;">Import Data (merge)</button>
            <input id="importFile" type="file" accept="application/json" style="display:none;" />
          </div>
        </div>
        <div class="row" style="grid-template-columns: 1fr;">
          <div>
            <label>Danger zone</label>
            <button id="btnEraseAll" class="btn danger" style="width:100%;">Erase All Data</button>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn ghost" id="settingsCancel">Close</button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <!-- Floating calendar toggle removed: click the day label or use header controls -->

  <script src="app.bundle.js"></script>
  
</body>
</html>

