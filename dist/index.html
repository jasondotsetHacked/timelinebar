<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Time Tracker — Single File</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="app">
    <div class="header">
      <div>
        <div class="title">Time Tracker</div>
        <div id="viewHelp" class="subtle"></div>
      </div>
    </div>

    <div class="top-controls" id="topControls" style="display:flex; justify-content: space-between; align-items:center; gap:8px;">
      <div id="dayLabel" class="subtle" title="Open calendar" tabindex="0" role="button"></div>
      <button id="btnCalendar" class="btn ghost" title="Open calendar">Calendar</button>
    </div>

    <section class="card calendar" id="calendarCard" style="display:none; padding:16px;">
      <div class="calendar-header" style="display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom:10px; padding:0 4px;">
        <button class="btn ghost" id="calPrev" title="Previous">&#171;</button>
        <div id="calMonthLabel" style="font-weight:700; letter-spacing:.2px;"></div>
        <button class="btn ghost" id="calNext" title="Next">&#187;</button>
      </div>
      <div class="calendar-weekdays" id="calWeekdays" style="display:grid; grid-template-columns: repeat(7, 1fr); gap:6px; margin-bottom:6px;">
        <div class="cal-weekday">Sun</div>
        <div class="cal-weekday">Mon</div>
        <div class="cal-weekday">Tue</div>
        <div class="cal-weekday">Wed</div>
        <div class="cal-weekday">Thu</div>
        <div class="cal-weekday">Fri</div>
        <div class="cal-weekday">Sat</div>
      </div>
      <div class="calendar-grid" id="calendarGrid" style="display:grid; grid-template-columns: repeat(7, 1fr); gap:6px;"></div>
    </section>

    <section class="card timeline">
      <div class="track" id="track" aria-label="Timeline track" role="application">
        <div class="ghost" id="ghost"></div>
        <div class="tip" id="tipStart"></div>
        <div class="tip" id="tipEnd"></div>
        <div class="tip tip-center" id="tipCenter"></div>
        <div class="tick-labels" id="ticks"></div>
      </div>
      <div class="help-row">
        <div>
          New: drag anywhere. Edit: drag a block's side handle.
        </div>
        <div style="display:flex; gap:8px; align-items:center;">
          <button id="viewDefault" class="btn ghost" title="Reset to 6am–6pm" style="padding:6px 10px; font-size:12px;">6–6</button>
          <button id="view24" class="btn ghost" title="Show 24 hours" style="padding:6px 10px; font-size:12px;">24h</button>
          <button id="btnCalendar2" class="btn ghost" title="Open calendar" style="padding:6px 10px; font-size:12px;">Calendar</button>
          <div id="total" class="subtle"></div>
        </div>
      </div>
    </section>

    <section class="card table-card">
      <table>
        <thead>
          <tr>
            <th style="width:40px"></th>
            <th style="width:140px">Start</th>
            <th style="width:140px">Stop</th>
            <th style="width:150px">Duration</th>
            <th style="width:180px">Bucket</th>
            <th>Note</th>
            <th style="width:120px">Actions</th>
          </tr>
        </thead>
        <tbody id="rows"></tbody>
      </table>
      <div class="empty" id="empty">No entries yet. Create your first by dragging on the timeline.</div>
    </section>
  </div>

  <div class="modal-backdrop" id="modal">
    <div class="card modal">
      <div class="modal-header">
        <div class="modal-title">New Time Block</div>
        <button class="icon-btn" id="modalClose" aria-label="Close">&#x2715;</button>
      </div>
      <form id="modalForm">
        <div class="body">
          <div class="row">
            <div>
              <label>Start</label>
              <input type="text" id="startField" readonly />
            </div>
            <div>
              <label>End</label>
              <input type="text" id="endField" readonly />
            </div>
          </div>
          <div class="row">
            <div>
              <label>Bucket</label>
              <input type="text" id="bucketField" placeholder="e.g. A-01" required />
            </div>
            <div>
              <label>Note</label>
              <textarea id="noteField" placeholder="Write a note… Markdown supported"></textarea>
              <div class="note-foot subtle">
                <span>Markdown supported</span>
                <span aria-hidden="true"> · </span>
                <a id="notePreviewToggle" href="#" role="button">Preview</a>
              </div>
              <div id="notePreview" class="note-preview" style="display:none;"></div>
            </div>
          </div>
          <div class="row">
            <div>
              <label>Status</label>
              <div class="status-wrap" id="modalStatusWrap">
                <button type="button" class="status-btn status-default" id="modalStatusBtn" aria-label="Status"></button>
                <div class="status-menu" id="modalStatusMenu">
                  <div class="status-option" data-value="default" title="Default"></div>
                  <div class="status-option" data-value="green" title="Green"></div>
                  <div class="status-option" data-value="yellow" title="Yellow"></div>
                  <div class="status-option" data-value="red" title="Red"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn danger" id="modalDelete">Delete</button>
          <button type="button" class="btn ghost" id="modalCancel">Cancel</button>
          <button type="submit" class="btn primary">Save</button>
        </div>
      </form>
    </div>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <!-- Floating calendar toggle removed: click the day label or use header controls -->

  <!-- Lightweight Markdown + sanitizer for rich note rendering -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify/dist/purify.min.js" crossorigin="anonymous"></script>
  <script src="app.bundle.js"></script>
  
</body>
</html>

